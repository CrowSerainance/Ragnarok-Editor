<UserControl x:Class="ROMapOverlayEditor.UserControls.GatEditorView"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006" 
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008" 
             xmlns:h="http://helix-toolkit.org/wpf"
             mc:Ignorable="d" 
             d:DesignHeight="600" d:DesignWidth="800">
    <!-- ================================================================== -->
    <!-- GatEditorView.xaml - FIXED VERSION                                 -->
    <!-- TARGET: ROMapOverlayEditor/UserControls/GatEditorView.xaml         -->
    <!-- ACTION: REPLACE ENTIRE FILE                                        -->
    <!-- ================================================================== -->
    <!-- CHANGES:                                                           -->
    <!--   1. GAT Overlay checkbox OFF by default                           -->
    <!--   2. Paint GAT Cells is now a TOGGLE BUTTON                        -->
    <!--   3. Cell type combo and radius are in a collapsible group         -->
    <!--   4. Paint controls enable/disable based on toggle state           -->
    <!-- ================================================================== -->
    <UserControl.Resources>
        <Style TargetType="{x:Type ComboBox}">
            <Setter Property="Foreground" Value="White"/>
            <Setter Property="Background" Value="#222"/>
        </Style>
        <Style TargetType="{x:Type TextBox}">
            <Setter Property="Foreground" Value="White"/>
            <Setter Property="Background" Value="#222"/>
            <Setter Property="CaretBrush" Value="White"/>
        </Style>
        <!-- Toggle Button Style for Paint Mode -->
        <Style x:Key="PaintToggleStyle" TargetType="ToggleButton">
            <Setter Property="Background" Value="#444"/>
            <Setter Property="Foreground" Value="White"/>
            <Setter Property="BorderBrush" Value="#555"/>
            <Setter Property="Padding" Value="10,5"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="ToggleButton">
                        <Border x:Name="border" Background="{TemplateBinding Background}" 
                                BorderBrush="{TemplateBinding BorderBrush}" BorderThickness="1" 
                                CornerRadius="3" Padding="{TemplateBinding Padding}">
                            <ContentPresenter HorizontalAlignment="Center" VerticalAlignment="Center"/>
                        </Border>
                        <ControlTemplate.Triggers>
                            <Trigger Property="IsChecked" Value="True">
                                <Setter TargetName="border" Property="Background" Value="#2D7D2D"/>
                                <Setter TargetName="border" Property="BorderBrush" Value="#4A4"/>
                            </Trigger>
                            <Trigger Property="IsMouseOver" Value="True">
                                <Setter TargetName="border" Property="Background" Value="#555"/>
                            </Trigger>
                            <MultiTrigger>
                                <MultiTrigger.Conditions>
                                    <Condition Property="IsMouseOver" Value="True"/>
                                    <Condition Property="IsChecked" Value="True"/>
                                </MultiTrigger.Conditions>
                                <Setter TargetName="border" Property="Background" Value="#3A9D3A"/>
                            </MultiTrigger>
                        </ControlTemplate.Triggers>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>
    </UserControl.Resources>
    
    <Grid Background="#2D2D30">
        <Grid.ColumnDefinitions>
            <ColumnDefinition Width="*" />
            <ColumnDefinition Width="250" />
        </Grid.ColumnDefinitions>

        <!-- 3D Viewport -->
        <h:HelixViewport3D x:Name="Viewport" Grid.Column="0" ShowCoordinateSystem="True" ShowFrameRate="True" Background="#1E1E1E">
            <h:HelixViewport3D.Camera>
                <PerspectiveCamera Position="50,100,50" LookDirection="-1,-2,-1" UpDirection="0,1,0" />
            </h:HelixViewport3D.Camera>
            <h:DefaultLights/>
        </h:HelixViewport3D>

        <!-- Sidebar / Tools -->
        <Border Grid.Column="1" Background="#252526" BorderBrush="#3E3E42" BorderThickness="1,0,0,0">
            <ScrollViewer VerticalScrollBarVisibility="Auto">
                <Grid Margin="10">
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="*"/>
                        <RowDefinition Height="Auto"/>
                    </Grid.RowDefinitions>

                    <TextBlock Text="3D Map Editor" Foreground="White" FontSize="18" FontWeight="Bold" Margin="0,0,0,10"/>

                    <!-- Load Controls -->
                    <StackPanel Grid.Row="1" Margin="0,0,0,15">
                        <Button Content="ðŸ“‚ Open 3D Map (RSW)..." Height="28" Margin="0,0,0,10" Background="#444" Foreground="White" Click="Open3DMap_Click"/>
                        
                        <TextBlock Text="Or Load by Name:" Foreground="#AAA" Margin="0,0,0,5"/>
                        <Grid Margin="0,0,0,5">
                             <Grid.ColumnDefinitions>
                                 <ColumnDefinition Width="*"/>
                                 <ColumnDefinition Width="Auto"/>
                             </Grid.ColumnDefinitions>
                             <TextBox x:Name="MapNameInput" Height="25" VerticalContentAlignment="Center" Background="#1E1E1E" Foreground="White" BorderBrush="#3A3A3A" Padding="6"/>
                             <Button x:Name="LoadMapBtn" Grid.Column="1" Content="Load" Width="50" Margin="5,0,0,0" Click="LoadMapBtn_Click"/>
                        </Grid>
                        <TextBlock x:Name="StatusLabel" Text="Ready" Foreground="#888" TextWrapping="Wrap" FontSize="11" Margin="0,5,0,0"/>
                        <ScrollViewer MaxHeight="100" Margin="0,8,0,0" VerticalScrollBarVisibility="Auto">
                            <TextBlock x:Name="PreviewText" Foreground="#AAA" TextWrapping="Wrap" FontSize="10" FontFamily="Consolas"/>
                        </ScrollViewer>
                    </StackPanel>

                    <!-- View Options -->
                    <GroupBox Header="View Options" Grid.Row="2" Margin="0,0,0,8" Foreground="#AAA" BorderBrush="#3A3A3A">
                        <StackPanel>
                            <CheckBox x:Name="ChkTerrainTextures" Content="Terrain (GND textures)" IsChecked="True" Foreground="White" Margin="0,0,0,4" Checked="ViewOptionChanged" Unchecked="ViewOptionChanged"/>
                            <CheckBox x:Name="ChkGatOverlay" Content="GAT Overlay (walkable / not-walkable)" IsChecked="False" Foreground="White" Margin="0,0,0,8" Checked="ViewOptionChanged" Unchecked="ViewOptionChanged"/>
                            
                            <TextBlock Text="Camera Mouse Speed (0.01â€“3)" Foreground="#AAA" Margin="0,4,0,2"/>
                            <Slider x:Name="CameraSpeedSlider" Minimum="0.01" Maximum="3" Value="1" TickFrequency="0.1" IsSnapToTickEnabled="False" ValueChanged="CameraSpeed_Changed"/>
                            <Button Content="Reset View (Even Out)" Click="ResetView_Click" Margin="0,8,0,4" Background="#444" Foreground="White"/>
                            
                            <TextBlock Text="Rotate" Foreground="#666" Margin="0,4,0,2"/>
                            <Slider x:Name="RotateSensSlider" Minimum="0.01" Maximum="5" Value="1" TickFrequency="0.1" IsSnapToTickEnabled="False" ValueChanged="SensSlider_Changed"/>
                            <TextBlock Text="Pan" Foreground="#666" Margin="0,4,0,2"/>
                            <Slider x:Name="PanSensSlider" Minimum="0.01" Maximum="5" Value="1" TickFrequency="0.1" IsSnapToTickEnabled="False" ValueChanged="SensSlider_Changed"/>
                            <TextBlock Text="Zoom" Foreground="#666" Margin="0,4,0,2"/>
                            <Slider x:Name="ZoomSensSlider" Minimum="0.01" Maximum="5" Value="1" TickFrequency="0.1" IsSnapToTickEnabled="False" ValueChanged="SensSlider_Changed"/>
                        </StackPanel>
                    </GroupBox>

                    <!-- ============================================= -->
                    <!-- PAINT GAT CELLS - NOW A TOGGLE SECTION       -->
                    <!-- ============================================= -->
                    <GroupBox Header="Paint GAT Cells" Grid.Row="3" Margin="0,0,0,8" Foreground="#AAA" BorderBrush="#3A3A3A">
                        <StackPanel>
                            <!-- Toggle Button to Enable/Disable Paint Mode -->
                            <ToggleButton x:Name="PaintModeToggle" 
                                          Content="ðŸŽ¨ Enable Paint Mode" 
                                          Style="{StaticResource PaintToggleStyle}"
                                          Height="32" 
                                          Margin="0,0,0,10"
                                          Checked="PaintModeToggle_Checked"
                                          Unchecked="PaintModeToggle_Unchecked"/>
                            
                            <!-- Paint Controls (enabled only when toggle is ON) -->
                            <StackPanel x:Name="PaintControlsPanel" IsEnabled="False" Opacity="0.5">
                                <TextBlock Text="Cell Type:" Foreground="#AAA" Margin="0,0,0,5"/>
                                <ComboBox x:Name="TypeCombo" Height="25" Margin="0,0,0,8" Background="#1E1E1E" Foreground="White" BorderBrush="#3A3A3A" Padding="6">
                                    <ComboBox.Resources>
                                        <Style TargetType="ComboBoxItem">
                                            <Setter Property="Foreground" Value="White"/>
                                            <Setter Property="Background" Value="#1E1E1E"/>
                                        </Style>
                                    </ComboBox.Resources>
                                </ComboBox>
                                
                                <TextBlock x:Name="RadiusLabel" Text="Brush Radius: 1" Foreground="#AAA" Margin="0,0,0,5"/>
                                <Slider x:Name="RadiusSlider" Minimum="1" Maximum="10" Value="1" TickFrequency="1" IsSnapToTickEnabled="True"/>
                                
                                <TextBlock Text="Left-click on terrain to paint cells" Foreground="#666" FontSize="10" Margin="0,8,0,0" TextWrapping="Wrap"/>
                            </StackPanel>
                        </StackPanel>
                    </GroupBox>

                    <!-- 3D Tool Mode (simplified) -->
                    <GroupBox Header="Camera Controls" Grid.Row="4" Margin="0,0,0,8" Foreground="#AAA" BorderBrush="#3A3A3A">
                        <StackPanel>
                            <TextBlock Text="Right-click = Orbit" Foreground="#888" FontSize="11" Margin="0,2"/>
                            <TextBlock Text="Middle-click = Pan" Foreground="#888" FontSize="11" Margin="0,2"/>
                            <TextBlock Text="Scroll wheel = Zoom" Foreground="#888" FontSize="11" Margin="0,2"/>
                            <Button Content="Rebuild Mesh" Height="28" Margin="0,10,0,0" Click="Rebuild_Click" Background="#444" Foreground="White"/>
                        </StackPanel>
                    </GroupBox>

                    <!-- Info -->
                    <TextBlock x:Name="PickInfo" Grid.Row="5" Foreground="Yellow" VerticalAlignment="Bottom" TextWrapping="Wrap" Margin="0,10"/>

                    <!-- Export -->
                    <StackPanel Grid.Row="6" Margin="0,10,0,0">
                         <Button Content="Save to Staging" Height="30" Margin="0,0,0,5" Click="SaveToStaging_Click" Background="#444" Foreground="White"/>
                         <Button Content="Export Patch ZIP..." Height="30" Click="ExportZip_Click" Background="#444" Foreground="White"/>
                    </StackPanel>
                </Grid>
            </ScrollViewer>
        </Border>
    </Grid>
</UserControl>
